# è¯„è®ºæ ‘å¯è§†åŒ–å·¥å…·

ä¸€ä¸ªç‹¬ç«‹çš„è¯„è®ºæ ‘å¯è§†åŒ–æ¨¡å—ï¼Œç”¨äºå±•ç¤ºè¯„è®ºçš„å±‚çº§å…³ç³»å’Œäº’åŠ¨æƒ…å†µã€‚

## ğŸ“ æ¨¡å—ç»“æ„

```
comment_tree_visualizer/
â”œâ”€â”€ __init__.py              # æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ main.py                  # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ data_loader.py           # æ•°æ®åŠ è½½å™¨
â”œâ”€â”€ tree_builder.py          # è¯„è®ºæ ‘æ„å»ºå™¨
â”œâ”€â”€ visualizer.py            # å¯è§†åŒ–ç”Ÿæˆå™¨
â””â”€â”€ README.md               # è¯´æ˜æ–‡æ¡£
```

## ğŸ—ï¸ è¯„è®ºæ ‘ç»“æ„

### æ•°æ®ç»“æ„è¯´æ˜

è¯„è®ºæ ‘é‡‡ç”¨å±‚çº§ç»“æ„è¡¨ç¤ºï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

#### èŠ‚ç‚¹å±æ€§
```json
{
  "id": "è¯„è®ºID",
  "content": "è¯„è®ºå†…å®¹",
  "create_time": 1640995200,
  "like_count": 15,
  "sub_comment_count": 3,
  "user_id": "ç”¨æˆ·ID",
  "nickname": "ç”¨æˆ·æ˜µç§°",
  "depth": 0,
  "total_children": 0,
  "total_likes": 0,
  "children": []
}
```

#### å­—æ®µè¯´æ˜
- **id**: è¯„è®ºå”¯ä¸€æ ‡è¯†ç¬¦
- **content**: è¯„è®ºæ–‡æœ¬å†…å®¹
- **create_time**: è¯„è®ºåˆ›å»ºæ—¶é—´ï¼ˆUnixæ—¶é—´æˆ³ï¼‰
- **like_count**: è¯¥è¯„è®ºçš„ç‚¹èµæ•°
- **sub_comment_count**: è¯¥è¯„è®ºçš„å­è¯„è®ºæ•°é‡
- **user_id**: è¯„è®ºç”¨æˆ·ID
- **nickname**: ç”¨æˆ·æ˜µç§°
- **depth**: è¯„è®ºåœ¨æ ‘ä¸­çš„æ·±åº¦ï¼ˆ0ä¸ºæ ¹è¯„è®ºï¼‰
- **total_children**: è¯¥èŠ‚ç‚¹ä¸‹æ‰€æœ‰å­è¯„è®ºæ€»æ•°
- **total_likes**: è¯¥èŠ‚ç‚¹ä¸‹æ‰€æœ‰è¯„è®ºçš„æ€»ç‚¹èµæ•°
- **children**: å­è¯„è®ºæ•°ç»„

### å±‚çº§å…³ç³»

```
è™šæ‹Ÿæ ¹èŠ‚ç‚¹ (ç°è‰²)
â”œâ”€â”€ æ ¹è¯„è®º1 (è“è‰²) - ç›´æ¥å›å¤è§†é¢‘
â”‚   â”œâ”€â”€ å­è¯„è®º1.1 (ç»¿è‰²) - å›å¤æ ¹è¯„è®º1
â”‚   â”‚   â””â”€â”€ å­è¯„è®º1.1.1 (ç»¿è‰²) - å›å¤å­è¯„è®º1.1
â”‚   â””â”€â”€ å­è¯„è®º1.2 (ç»¿è‰²) - å›å¤æ ¹è¯„è®º1
â”œâ”€â”€ æ ¹è¯„è®º2 (è“è‰²) - ç›´æ¥å›å¤è§†é¢‘
â”‚   â””â”€â”€ å­è¯„è®º2.1 (ç»¿è‰²) - å›å¤æ ¹è¯„è®º2
â””â”€â”€ æ ¹è¯„è®º3 (çº¢è‰²) - çƒ­é—¨è¯„è®ºï¼Œç‚¹èµæ•°>50
```

### é¢œè‰²ç¼–ç 

| é¢œè‰² | å«ä¹‰ | æ¡ä»¶ |
|------|------|------|
| ğŸ”´ çº¢è‰² | çƒ­é—¨è¯„è®º | ç‚¹èµæ•° > 50 |
| ğŸŸ¡ é»„è‰² | é«˜ç‚¹èµè¯„è®º | ç‚¹èµæ•° > 20 |
| ğŸ”µ è“è‰² | æ ¹è¯„è®º | æ·±åº¦ = 0 |
| ğŸŸ¢ ç»¿è‰² | å­è¯„è®º | æ·±åº¦ > 0 |
| âš« ç°è‰² | è™šæ‹Ÿæ ¹èŠ‚ç‚¹ | ç³»ç»Ÿç”Ÿæˆ |

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **å¤šæ•°æ®æºæ”¯æŒ**: CSVã€JSONã€MySQLã€SQLiteã€Processedæ•°æ®
- âœ… **äº¤äº’å¼å¯è§†åŒ–**: åŸºäºD3.jsçš„æ ‘å½¢å›¾å±•ç¤º
- âœ… **æœç´¢åŠŸèƒ½**: æŒ‰è¯„è®ºå†…å®¹æˆ–ç”¨æˆ·åæœç´¢
- âœ… **èŠ‚ç‚¹å±•å¼€/æ”¶èµ·**: ç‚¹å‡»èŠ‚ç‚¹æ§åˆ¶æ˜¾ç¤º
- âœ… **å·¥å…·æç¤º**: é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
- âœ… **ç»Ÿè®¡ä¿¡æ¯**: å®æ—¶æ˜¾ç¤ºè¯„è®ºæ•°æ®ç»Ÿè®¡

### å¯è§†åŒ–ç‰¹æ€§
- ğŸŒ³ **æ ‘å½¢å¸ƒå±€**: æ¸…æ™°å±•ç¤ºè¯„è®ºå±‚çº§å…³ç³»
- ğŸ¨ **é¢œè‰²åŒºåˆ†**: æ ¹æ®ç‚¹èµæ•°å’Œæ·±åº¦åŒºåˆ†èŠ‚ç‚¹ç±»å‹
- ğŸ“ **èŠ‚ç‚¹å¤§å°**: æ”¯æŒæŒ‰ç‚¹èµæ•°ã€å›å¤æ•°æˆ–å›ºå®šå¤§å°æ˜¾ç¤º
- ğŸ” **æœç´¢é«˜äº®**: æœç´¢ç»“æœå¿«é€Ÿå®šä½
- ğŸ“± **å“åº”å¼è®¾è®¡**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸

## ğŸ“Š è¾“å‡ºæ–‡ä»¶

ç”Ÿæˆçš„å¯è§†åŒ–æ–‡ä»¶åŒ…æ‹¬ï¼š

1. **comment_tree_visualization.html** - å®Œæ•´ç‰ˆäº¤äº’å¼å¯è§†åŒ–
   - åŸºäºD3.jsçš„æ ‘å½¢å›¾
   - æ”¯æŒæœç´¢ã€å±•å¼€/æ”¶èµ·ã€å·¥å…·æç¤º
   - å®æ—¶ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º

2. **comment_tree_simple.html** - ç®€åŒ–ç‰ˆå¯è§†åŒ–
   - çº¯HTML/CSS/JavaScriptå®ç°
   - ä¸ä¾èµ–å¤–éƒ¨åº“
   - é€‚åˆç¦»çº¿ç¯å¢ƒ

3. **comment_tree_data.json** - è¯„è®ºæ ‘æ•°æ®
   - å®Œæ•´çš„æ ‘å½¢ç»“æ„æ•°æ®
   - å¯ç”¨äºå…¶ä»–åˆ†æå·¥å…·

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# ä»processedæ•°æ®ç”Ÿæˆå¯è§†åŒ–
python main.py --source processed --output output_dir

# ä»CSVæ–‡ä»¶ç”Ÿæˆå¯è§†åŒ–
python main.py --source csv --input data.csv --output output_dir

# ä»JSONæ–‡ä»¶ç”Ÿæˆå¯è§†åŒ–
python main.py --source json --input data.json --output output_dir

# ä»MySQLæ•°æ®åº“ç”Ÿæˆå¯è§†åŒ–
python main.py --source mysql --db-name database --db-user user --db-password pass --output output_dir

# è‡ªå®šä¹‰å‚æ•°
python main.py --source processed --output output_dir --title "æˆ‘çš„è¯„è®ºæ ‘" --max-depth 3
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `--source` | str | âœ… | - | æ•°æ®æºç±»å‹ (csv/json/mysql/sqlite/processed) |
| `--input` | str | æ¡ä»¶ | - | è¾“å…¥æ–‡ä»¶è·¯å¾„ (csv/json/sqliteæ¨¡å¼å¿…éœ€) |
| `--output` | str | âŒ | output | è¾“å‡ºç›®å½•è·¯å¾„ |
| `--title` | str | âŒ | è¯„è®ºæ ‘å¯è§†åŒ– | é¡µé¢æ ‡é¢˜ |
| `--max-depth` | int | âŒ | 5 | æœ€å¤§æ˜¾ç¤ºæ·±åº¦ |
| `--db-name` | str | æ¡ä»¶ | - | æ•°æ®åº“åç§° (mysqlæ¨¡å¼å¿…éœ€) |
| `--db-user` | str | æ¡ä»¶ | - | æ•°æ®åº“ç”¨æˆ·å (mysqlæ¨¡å¼å¿…éœ€) |
| `--db-password` | str | æ¡ä»¶ | - | æ•°æ®åº“å¯†ç  (mysqlæ¨¡å¼å¿…éœ€) |
| `--db-host` | str | âŒ | localhost | æ•°æ®åº“ä¸»æœº |
| `--db-port` | int | âŒ | 3306 | æ•°æ®åº“ç«¯å£ |

### ç¼–ç¨‹æ¥å£

```python
from data_loader import CommentDataLoader
from tree_builder import CommentTreeBuilder
from visualizer import CommentTreeVisualizer

# åŠ è½½æ•°æ®
loader = CommentDataLoader()
df = loader.load_from_processed()

# æ„å»ºè¯„è®ºæ ‘
builder = CommentTreeBuilder()
tree_data = builder.build_tree(df, max_depth=5)

# ç”Ÿæˆå¯è§†åŒ–
visualizer = CommentTreeVisualizer(tree_data)
visualizer.generate_html('output.html', 'è¯„è®ºæ ‘å¯è§†åŒ–')
```

## ğŸ“‹ æ•°æ®æºæ ¼å¼

### CSVæ ¼å¼
```csv
comment_id,parent_comment_id,content,create_time,like_count,sub_comment_count,user_id,nickname
1,0,è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§†é¢‘ï¼,1640995200,15,3,user1,ç”¨æˆ·A
2,1,åŒæ„ï¼Œå†…å®¹å¾ˆæœ‰ä»·å€¼,1640995260,8,1,user2,ç”¨æˆ·B
```

### JSONæ ¼å¼
```json
[
  {
    "comment_id": "1",
    "parent_comment_id": "0",
    "content": "è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§†é¢‘ï¼",
    "create_time": 1640995200,
    "like_count": 15,
    "sub_comment_count": 3,
    "user_id": "user1",
    "nickname": "ç”¨æˆ·A"
  }
]
```

### æ•°æ®åº“è¡¨ç»“æ„
```sql
CREATE TABLE comments (
    comment_id VARCHAR(50) PRIMARY KEY,
    parent_comment_id VARCHAR(50),
    content TEXT,
    create_time BIGINT,
    like_count INT,
    sub_comment_count INT,
    user_id VARCHAR(50),
    nickname VARCHAR(100)
);
```

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç®—æ³•

1. **æ•°æ®é¢„å¤„ç†**
   - æ•°æ®æ¸…æ´—å’Œæ ¼å¼éªŒè¯
   - ç¼ºå¤±å€¼å¤„ç†
   - æ—¶é—´æˆ³è½¬æ¢

2. **æ ‘å½¢æ„å»º**
   - åŸºäºparent_comment_idæ„å»ºçˆ¶å­å…³ç³»
   - è®¡ç®—èŠ‚ç‚¹æ·±åº¦å’Œç»Ÿè®¡ä¿¡æ¯
   - ç”Ÿæˆè™šæ‹Ÿæ ¹èŠ‚ç‚¹è¿æ¥å¤šä¸ªæ ¹è¯„è®º

3. **å¯è§†åŒ–æ¸²æŸ“**
   - D3.jsæ ‘å½¢å¸ƒå±€ç®—æ³•
   - èŠ‚ç‚¹é¢œè‰²å’Œå¤§å°æ˜ å°„
   - äº¤äº’äº‹ä»¶å¤„ç†

### æ€§èƒ½ä¼˜åŒ–

- æ”¯æŒå¤§æ•°æ®é›†çš„åˆ†é¡µåŠ è½½
- æ ‘å½¢ç»“æ„çš„æ‡’åŠ è½½
- æœç´¢ç»“æœçš„ç¼“å­˜æœºåˆ¶
- å“åº”å¼å¸ƒå±€é€‚é…

## ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯

ç”Ÿæˆçš„ç»Ÿè®¡ä¿¡æ¯åŒ…æ‹¬ï¼š

- **æ€»è¯„è®ºæ•°**: æ‰€æœ‰è¯„è®ºçš„æ•°é‡
- **æ ¹è¯„è®ºæ•°**: ç›´æ¥å›å¤è§†é¢‘çš„è¯„è®ºæ•°é‡
- **æœ€å¤§æ·±åº¦**: è¯„è®ºæ ‘çš„æœ€å¤§å±‚çº§æ·±åº¦
- **æ€»ç‚¹èµæ•°**: æ‰€æœ‰è¯„è®ºçš„ç‚¹èµæ€»æ•°
- **å¹³å‡ç‚¹èµæ•°**: æ¯æ¡è¯„è®ºçš„å¹³å‡ç‚¹èµæ•°

## ğŸ¯ åº”ç”¨åœºæ™¯

- **ç¤¾äº¤åª’ä½“åˆ†æ**: åˆ†æè¯„è®ºäº’åŠ¨æ¨¡å¼
- **å†…å®¹è´¨é‡è¯„ä¼°**: é€šè¿‡è¯„è®ºçƒ­åº¦è¯„ä¼°å†…å®¹è´¨é‡
- **ç”¨æˆ·è¡Œä¸ºç ”ç©¶**: ç ”ç©¶ç”¨æˆ·è¯„è®ºä¹ æƒ¯
- **ç¤¾åŒºç®¡ç†**: è¯†åˆ«çƒ­é—¨è¯é¢˜å’Œäº‰è®®å†…å®¹
- **æ•°æ®å¯è§†åŒ–**: ä¸ºæŠ¥å‘Šå’Œæ¼”ç¤ºæä¾›å¯è§†åŒ–æ”¯æŒ

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åŠ è½½å¤±è´¥**
   - æ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œæ ¼å¼
   - éªŒè¯æ•°æ®åº“è¿æ¥å‚æ•°
   - ç¡®è®¤æ•°æ®æºæƒé™

2. **å¯è§†åŒ–æ˜¾ç¤ºå¼‚å¸¸**
   - æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
   - ç¡®è®¤D3.jsåº“åŠ è½½æˆåŠŸ
   - éªŒè¯JSONæ•°æ®æ ¼å¼

3. **æ€§èƒ½é—®é¢˜**
   - å‡å°‘æœ€å¤§æ·±åº¦å‚æ•°
   - ä½¿ç”¨æ•°æ®è¿‡æ»¤æ¡ä»¶
   - è€ƒè™‘åˆ†é¡µåŠ è½½

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… æ”¯æŒå¤šç§æ•°æ®æº
- âœ… äº¤äº’å¼æ ‘å½¢å¯è§†åŒ–
- âœ… æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½
- âœ… å“åº”å¼è®¾è®¡

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ LICENSE æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

---

**æ³¨æ„**: æœ¬æ¨¡å—å®Œå…¨ç‹¬ç«‹äºä¸»é¡¹ç›®ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨å’Œéƒ¨ç½²ã€‚
